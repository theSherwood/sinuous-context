{"version":3,"file":"sinuous-context.esm.js","sources":["../src/context.js"],"sourcesContent":["import { api } from 'sinuous';\n\nconst pipe = (f, g) => (...args) => g(...f(...args));\n\napi.insert = pipe(enableTracking, api.insert);\napi.property = pipe(enableTracking, api.property);\n\nlet tracking = {};\n\n// Wraps any dynamic content (observables, computeds, other components)\n// embedded in components with hierarchical context tracking.\nfunction enableTracking(el, value, ...args) {\n  if (typeof value !== 'function') {\n    return [el, value, ...args];\n  }\n\n  function tracker(...args) {\n    const prevTracking = tracking;\n    tracking = tracker._tracking;\n    const result = value(...args);\n    tracking = prevTracking;\n    return result;\n  }\n  tracker._tracking = { ...tracking };\n\n  return [el, tracker, ...args];\n}\n\n// Calls all the Sinuous component functions in the array of children\nfunction getChildrenAsNodes(children) {\n  return children.flatMap((child) => {\n    while (typeof child === 'function') {\n      child = child();\n    }\n    if (child instanceof DocumentFragment) {\n      return getChildrenAsNodes(Array.from(child.children));\n    }\n    if (Array.isArray(child)) {\n      return getChildrenAsNodes(child);\n    }\n    return child;\n  });\n}\n\n/**\n * Used like a component. Pass `key: value` pairs as props.\n *\n * @example\n * let view = html`\n *    <${Context} key1=${value1} key2=${value2}>\n *      <${Component1} />\n *      <${Component2} />\n *      <div>\n *        <${Component3} />\n *      </div>\n *    <//>\n * `;\n *\n * @param {Object} context\n * @param  {...*} children\n * @returns {Function}\n */\nfunction context(context, ...children) {\n  function update() {\n    const prevContext = tracking._ctx;\n    tracking._ctx = { ...prevContext, ...update._ctx };\n    const result = getChildrenAsNodes(children);\n    tracking._ctx = prevContext;\n    return result;\n  }\n\n  update._ctx = context;\n  return update;\n}\n\nexport { context, context as Context };\n\n/**\n * If `key` is passed, returns the context value for that `key` that is\n * nearest in the context hierarchy; otherwise, returns an object of every\n * key/value pair visible from that level of the context hierarchy.\n *\n * @example\n * // assume context = { key1: value1, key2: value2 }\n * let c = getContext('key1') // c = value1\n *\n * @example\n * // assume context = { key1: value1, key2: value2 }\n * let c = getContext() // c = { key1: value1, key2: value2 }\n *\n * @param {String} [key] - This is probably the prop name.\n * @returns {*} Either the value assigned to `key` or all key/value pairs\n * at that level of the hierarchy.\n */\nexport function getContext(key) {\n  return arguments.length === 0\n    ? tracking && tracking._ctx\n    : tracking && tracking._ctx && tracking._ctx[key];\n}\n"],"names":[],"mappings":"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"}